package com.xinguang.imaglib.cycleImage;

import android.content.Context;
import android.content.Intent;
import android.support.annotation.NonNull;

import com.xinguang.imaglib.R;
import com.xinguang.imaglib.cycleImage.cycle.CycleViewDetails;
import com.xinguang.imaglib.cycleImage.cycle.CycleViewZoomManager;
import com.xinguang.imaglib.imageviewermodule.ImageViewerActivity;

import java.util.ArrayList;

/**
 * 这是给js用的
 * Created by lingwang on 2018/4/20.
 */

public class CycleImageView extends BaseFrameLayout {
    CycleViewDetails cycleViewDetails;
    CycleViewZoomManager cycleViewZoomManager;//大小屏管理对象

    public CycleImageView(@NonNull Context context) {
        super(context);
    }

    @Override
    public void init() {
        setContentView(R.layout.view_cycle_details_js);
        cycleViewDetails = (CycleViewDetails) findViewById(R.id.cycle_details);
    }

    @Override
    public void initData() {


        cycleViewZoomManager = CycleViewZoomManager.getInstance();
        //注册
        cycleViewZoomManager.addObserve(new CycleViewZoomManager.UpVideo() {
            @Override
            public void upMin() {

            }

            @Override
            public void upMax() {
                Intent intent = new Intent(context, ImageViewerActivity.class);
                intent.putStringArrayListExtra("videos", video);
                intent.putStringArrayListExtra("pics", pic);
                intent.putExtra("address", address);
                intent.putExtra("position", cycleViewDetails.getPosition());
                context.startActivity(intent);
            }

            @Override
            public void upPosition(int position) {
//                Log.e("aaaaaa",""+position);//不进行回调，容易出现页面丢失
//                cycleViewDetails.setPosition(position);
            }
        });
    }


    ArrayList<String> video;
    ArrayList<String> pic;
    String address;

    /**
     * @param video   视频地址集合
     * @param pic     图片地址集合
     * @param address 视频封面
     */
    public void setCycleDatas(ArrayList<String> video, ArrayList<String> pic, String address) {
        this.video = video;
        this.pic = pic;
        this.address = address;
        cycleViewDetails.setCycleDatas(video, pic, address);
    }

    protected void onDestroy() {
        //清除头部轮播中的监听
        cycleViewZoomManager.removeObserveAll();
    }

}
